<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
<!--    <meta charset="utf-8">-->
<!--    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">-->

<!--    &lt;!&ndash; Bootstrap CSS &ndash;&gt;-->
<!--    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">-->

    <title>Геолокация</title>
 <script src="https://api-maps.yandex.ru/2.1/?apikey=cd08d7d2-5ca0-4751-bacf-e683f00a8ed6&lang=ru_RU" type="text/javascript">
    </script>
<!-- Change my.cdn.tld to your CDN host name -->
    <script src="https://yastatic.net/s3/mapsapi-jslibs/heatmap/0.0.1/heatmap.min.js" type="text/javascript"></script>
{%if success%}
<script type="text/javascript">
    ymaps.ready(['Heatmap']).then(function init() {

    var myMap = new ymaps.Map('map', {
        center: [60, 120],
        zoom: 3,
        controls: []
    });
{%if map_type == "heatmap"%}
    var data = {
              type: 'FeatureCollection',
              features: [
              {%for p in potencial%}
              {
                  id: {{p.id}},
                  type: 'Feature',
                  geometry: {
                      type: 'Point',
                      coordinates: [{{p.lat}}, {{p.lon}}]
                  },
                  properties: {
                      weight: {{p.potencial}}
                  }
              },
              {%endfor%}]
          };
    var heatmap = new ymaps.Heatmap(data, {
        // Радиус влияния.
        radius: 7,
        // Нужно ли уменьшать пиксельный размер точек при уменьшении зума. False - не нужно.
        dissipating: true,
        // Прозрачность тепловой карты.
        opacity: 0.8,
        // Прозрачность у медианной по весу точки.
        intensityOfMidpoint: 0.2,
        // JSON описание градиента.
        gradient: {
            0.1: 'rgba(128, 255, 0, 0.7)',
            0.2: 'rgba(255, 255, 0, 0.8)',
            0.7: 'rgba(234, 72, 58, 0.9)',
            1.0: 'rgba(162, 36, 25, 1)'
        }
    });
    heatmap.setMap(myMap);

{%else%}
    {%for p in potencial%}
    {%if p.potencial < 50%}
    var myPlacemark{{p.id}} = new ymaps.Placemark([{{p.lat}}, {{p.lon}}], {
		balloonContentHeader: "{{p.address}}",
        balloonContentBody: "Потенциал {{p.potencial}}",
<!--        balloonContentFooter: "Клиентов {{p.all_clients}}. Зарплатников {{p.payroll}}",-->
<!--		hintContent: "{{p.address}}. Клиентов {{p.all_clients}}. Зарплатников {{p.payroll}}. Вероятный потенциал {{p.potencial}}"-->
	}, {
		preset: 'islands#yellowCircleDotIcon',
	});
	myMap.geoObjects.add(myPlacemark{{p.id}});
	{%endif%}
	{%endfor%}

	{%for p in potencial%}
	{%if p.potencial >= 50 and p.potencial < 100%}
    var myPlacemark{{p.id}} = new ymaps.Placemark([{{p.lat}}, {{p.lon}}], {
		balloonContentHeader: "{{p.address}}",
        balloonContentBody: "Вероятный потенциал {{p.potencial}}",
<!--        balloonContentFooter: "Клиентов {{p.all_clients}}. Зарплатников {{p.payroll}}",-->
<!--		hintContent: "{{p.address}}. Клиентов {{p.all_clients}}. Зарплатников {{p.payroll}}. Вероятный потенциал {{p.potencial}}"-->
	}, {
	    preset: 'islands#redCircleDotIcon',
	});
	myMap.geoObjects.add(myPlacemark{{p.id}});
	{%endif%}
	{%endfor%}

	{%for p in potencial%}
	{%if p.potencial >= 100%}
    var myPlacemark{{p.id}} = new ymaps.Placemark([{{p.lat}}, {{p.lon}}], {
		balloonContentHeader: "{{p.address}}",
        balloonContentBody: "Вероятный потенциал {{p.potencial}}",
<!--        balloonContentFooter: "Клиентов {{p.all_clients}}. Зарплатников {{p.payroll}}",-->
<!--		hintContent: "{{p.address}}. Клиентов {{p.all_clients}}. Зарплатников {{p.payroll}}. Вероятный потенциал {{p.potencial}}"-->
	}, {
        preset: 'islands#brownCircleDotIcon',
	});
	myMap.geoObjects.add(myPlacemark{{p.id}});
	{%endif%}
	{%endfor%}
{%endif%}
    });
</script>
{%endif%}
</head>
<body>
<!--<form class="form-horizontal" method="post" enctype="multipart/form-data" action="">-->
<!--{%if map_type == "placemark"%}-->
<!--<input type = "text" name="map_type" value="heatmap" hidden />-->
<!--<div class="form-group">-->
<!--  <div class="col-sm-offset-2 col-sm-8">-->
<!--    <button type="submit" class="btn btn-secondary">Переключить на тепловую карту</button>-->
<!--  </div>-->
<!-- </div>-->
<!--{%else%}-->
<!-- <input type = "text" name="map_type" value="placemark" hidden />-->
<!--<div class="form-group">-->
<!--  <div class="col-sm-offset-2 col-sm-8">-->
<!--    <button type="submit" class="btn btn-secondary">Переключить на метки</button>-->
<!--  </div>-->
<!-- </div>-->
<!--{%endif%}-->
<!--</form>-->
<!--{%if success%}-->
<!--<form class="form-horizontal" method="post" enctype="multipart/form-data" action="">-->
<!--&lt;!&ndash;<input type = "text" name="user_tab" value="{{user_tab}}" hidden />&ndash;&gt;-->
<!--&lt;!&ndash;<input type = "text" name="data_type" value="{{data_type}}" hidden />&ndash;&gt;-->
<!-- <div class="form-group">-->
<!--  <div class="col-sm-8">-->
<!-- <input type="file" name="coordinates" id="file">-->
<!--  </div>-->
<!-- </div>-->
<!-- <div class="form-group">-->
<!--  <div class="col-sm-offset-2 col-sm-8">-->
<!-- <button type="submit" class="btn btn-secondary">Загрузить</button>-->
<!-- <div></div>-->
<!--  </div>-->
<!-- </div>-->
<!--</form>-->
<table class="table table-borderless">
  <thead>
    <tr>
      <th scope="col"><div id="map" style="width: 1024px; height: 760px"></div></th>

    </tr>
  </thead>
<!--    <tbody>-->
<!--    <tr>-->
<!--        <th scope="col">-->
<!--          <p>Адресов: {{count}}, вероятный потенциал: {{sum}} нп</p>-->

<!--          <p>Топ 10:</p>-->
<!--          {%for t in top%}-->
<!--          <p>{{t.0}} - {{t.1}} нп</p>-->
<!--          {%endfor%}-->
<!--      </th>-->
<!--    </tr>-->
<!--    </tbody>-->
</table>

<!--{%endif%}-->


</body>
</html>
